<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Formulario Google</title>
  <!-- Librería para leer bien el CSV de Google -->
<script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>


<style>
body{
  font-family: Arial, Helvetica, sans-serif;
  background:#f4f6f8;
  margin:0;
  padding:30px;
}
  

  
  #resumenContenido table {
  width: 100%;
  table-layout: auto;
}

#resumenContenido th,
#resumenContenido td {
  border: 1px solid #ccc;
  padding: 6px;
  white-space: nowrap;
  text-align: left;
}

#resumenContenido th {
  background: #f2f2f2;
  position: sticky;
  top: 0;
}



  
h2{ text-align:center; margin-bottom:25px; }

form{
  max-width:1200px;
  margin:auto;
  background:white;
  padding:30px;
  border-radius:10px;
  box-shadow:0 10px 25px rgba(0,0,0,0.1);
}

.grid{
  display:grid;
  grid-template-columns: repeat(3, 1fr);
  gap:20px;
}

.campo{ display:flex; flex-direction:column; }

.campo label{
  font-size:13px;
  font-weight:bold;
  margin-bottom:6px;
}

.campo input,
.campo select{
  padding:10px;
  border-radius:6px;
  border:1px solid #ccc;
  font-size:14px;
}

.campo input:focus,
.campo select:focus{
  border-color:#007bff;
  outline:none;
  box-shadow:0 0 0 2px rgba(0,123,255,0.2);
}

button{
  margin-top:25px;
  padding:12px;
  width:100%;
  border:none;
  border-radius:6px;
  background:#007bff;
  color:white;
  font-size:16px;
  cursor:pointer;
}
button:hover{ background:#0056b3; }

.error{ border:2px solid red !important; }
.full{ grid-column: span 3; }
</style>
</head>

<body>

<h2>Registro</h2>

<form id="googleForm">
<div class="grid">

<div class="campo">
<label>Representante *</label>
<select name="entry.223399256" required>
<option value="">Selecciona Representante</option>
    <option value="AGUILAR VARGAS URSULA NOEMI">AGUILAR VARGAS URSULA NOEMI</option>
    <option value="ALTAMIRANO MEGO MARIO SERGIO">ALTAMIRANO MEGO MARIO SERGIO</option>
    <option value="ARBOLEDA SERRATO MEDALITH DEL ROCIO">ARBOLEDA SERRATO MEDALITH DEL ROCIO</option>
    <option value="BALAREZO CASTILLO KEYLA KATHERINE">BALAREZO CASTILLO KEYLA KATHERINE</option>
    <option value="BALLENA FERRE SARA FABIOLA">BALLENA FERRE SARA FABIOLA</option>
    <option value="BECERRA GOMEZ PACO JHORDAN">BECERRA GOMEZ PACO JHORDAN</option>
    <option value="BERRU MENDOZA MARIA ELIZABETH">BERRU MENDOZA MARIA ELIZABETH</option>
    <option value="CARRANZA CHAVESTA JOSE ROMY">CARRANZA CHAVESTA JOSE ROMY</option>
    <option value="CHUNG ESPEJO JUAN FRANCISCO">CHUNG ESPEJO JUAN FRANCISCO</option>
    <option value="CHUNGA PIZARRO MARGARETH ESTEFANI">CHUNGA PIZARRO MARGARETH ESTEFANI</option>
    <option value="CRISANTO GARRIDO DEYSI MARIBEL">CRISANTO GARRIDO DEYSI MARIBEL</option>
    <option value="CRISANTO LARTIGA MARIA VANESSA">CRISANTO LARTIGA MARIA VANESSA</option>
    <option value="DELGADO FARRO MITZY YOSHELY">DELGADO FARRO MITZY YOSHELY</option>
    <option value="DIAZ ACUÑA PAOLA STEFANIE">DIAZ ACUÑA PAOLA STEFANIE</option>
    <option value="DIAZ QUIROZ JOSE GALENO">DIAZ QUIROZ JOSE GALENO</option>
    <option value="ESPINOZA SILVA KIMBERLY YAMILE">ESPINOZA SILVA KIMBERLY YAMILE</option>
    <option value="FLORES NAVAL JUANA DEL PILAR">FLORES NAVAL JUANA DEL PILAR</option>
    <option value="GORDILLO YAIPEN EDITH MADELEI">GORDILLO YAIPEN EDITH MADELEI</option>
    <option value="GONZALES SAENZ EDGARDO DAVID">GONZALES SAENZ EDGARDO DAVID</option>
    <option value="GUTIERREZ MENDOZA TERESA OCDULIA">GUTIERREZ MENDOZA TERESA OCDULIA</option>
    <option value="HORNA CARRERO LILIANA">HORNA CARRERO LILIANA</option>
    <option value="LARIOS FIESTAS YESENIA PAOLA">LARIOS FIESTAS YESENIA PAOLA</option>
    <option value="LUCERO COTRINA JAIME ENRIQUE">LUCERO COTRINA JAIME ENRIQUE</option>
    <option value="LUNA TERRONES MIRIAN ROCIO">LUNA TERRONES MIRIAN ROCIO</option>
    <option value="MANAYAY ABAZALO BEVERLY BEATRIZ">MANAYAY ABAZALO BEVERLY BEATRIZ</option>
    <option value="MASABEL RIVAS GUILLERMINA DEL ROSARIO">MASABEL RIVAS GUILLERMINA DEL ROSARIO</option>
    <option value="MELENDEZ DEL CASTILLO FERNANDO GABRIEL">MELENDEZ DEL CASTILLO FERNANDO GABRIEL</option>
    <option value="ORTIZ SALAZAR ANABELEN">ORTIZ SALAZAR ANABELEN</option>
    <option value="PEREZ BANCES EDUARDO XKANLEONX ROLANDO">PEREZ BANCES EDUARDO XKANLEONX ROLANDO</option>
    <option value="PEREZ GONZALES KATHERINE YESSENIA">PEREZ GONZALES KATHERINE YESSENIA</option>
    <option value="RIOJAS TERRONES ANGELLA LIZETH">RIOJAS TERRONES ANGELLA LIZETH</option>
    <option value="RIVERA MERA JESSICA KARINA">RIVERA MERA JESSICA KARINA</option>
    <option value="SALAZAR VASQUEZ ANTONI MIGUEL">SALAZAR VASQUEZ ANTONI MIGUEL</option>
    <option value="SANCHEZ VILLAFRANQUI STEPHANO MIGUEL">SANCHEZ VILLAFRANQUI STEPHANO MIGUEL</option>
    <option value="SIRLUPU YOVERA AMALIA MARGOT">SIRLUPU YOVERA AMALIA MARGOT</option>
    <option value="SOTELO CHUMBE ABENCIA">SOTELO CHUMBE ABENCIA</option>
    <option value="TORRES OLANO PIERO ALEJANDRO">TORRES OLANO PIERO ALEJANDRO</option>
    <option value="TRIGOSO AYALA LISET MABEL">TRIGOSO AYALA LISET MABEL</option>
    <option value="UGAZ SAAVEDRA TIFFANY BRICET">UGAZ SAAVEDRA TIFFANY BRICET</option>
    <option value="VALDERRAMA CAJO FABIOLA KATHERINE MILAGROS DEL SOL">VALDERRAMA CAJO FABIOLA KATHERINE MILAGROS DEL SOL</option>
    <option value="VELASQUEZ SENMACHE MIGUEL ANGEL">VELASQUEZ SENMACHE MIGUEL ANGEL</option>
    <option value="VELASQUEZ FRIAS LIZBETH KARELLY">VELASQUEZ FRIAS LIZBETH KARELLY</option>
    <option value="VELIZ CHOQUE JANETH JHOSELIE">VELIZ CHOQUE JANETH JHOSELIE</option>
    <option value="ÑIQUEN ARROYO KATTIA LISET">ÑIQUEN ARROYO KATTIA LISET</option>
  <option value="SANTISTEVAN DE LOS SANTOS DAHYANA MAGALI">SANTISTEVAN DE LOS SANTOS DAHYANA MAGALI</option>
  <option value="HUERTAS CORREA MARIA DE LOS ANGELES">HUERTAS CORREA MARIA DE LOS ANGELES</option>
  <option value="SOTO CORREA SANDRA ELIZABETH">SOTO CORREA SANDRA ELIZABETH</option>
  <option value="ZAPATA BENAVIDES DELIA LISSETH">ZAPATA BENAVIDES DELIA LISSETH</option>
  <option value="MACO RENTERIA LUISA MARIA">MACO RENTERIA LUISA MARIA</option>
  <option value="VASQUEZ LLONTOP TATIANA SILVINA">VASQUEZ LLONTOP TATIANA SILVINA</option>
  <option value="CARLIN TARRILLO KATERINE DEL ROSARIO">CARLIN TARRILLO KATERINE DEL ROSARIO</option>
  <option value="FERNANDEZ JAVIEL OMAR GABRIEL">FERNANDEZ JAVIEL OMAR GABRIEL</option>
  <option value="CASTRO LEONARDO RAY RIGO">CASTRO LEONARDO RAY RIGO</option>
  <option value="SANDOVAL URCIA JACKELINA DEL ROCIO">SANDOVAL URCIA JACKELINA DEL ROCIO</option>
  <option value="VASQUEZ SAMAME KARLA FABIOLA">VASQUEZ SAMAME KARLA FABIOLA</option>
  <option value="QUINTANILLA MORI KATHERINE DARLEN">QUINTANILLA MORI KATHERINE DARLEN</option>
  <option value="PIÑELLA CHUNGA WALTER GABRIEL ANTONIO">PIÑELLA CHUNGA WALTER GABRIEL ANTONIO</option>
  <option value="SANCHEZ TOCTO KEYLI NATALI">SANCHEZ TOCTO KEYLI NATALI</option>
  <option value="MORALES CHAMBERGO GERALDINE ELENA">MORALES CHAMBERGO GERALDINE ELENA</option>
  <option value="ESPINOZA PURISACA DANIEL DAVID">ESPINOZA PURISACA DANIEL DAVID</option>
  
</select>
</div>

<div class="campo">
<label>Tenencia *</label>
<select id="Tenencia" name="entry.263067344" required>
<option value="">Selecciona</option>
<option value="Trio">Trio</option>
<option value="Duo">Duo</option>
<option value="Mono">Mono</option>
</select>
</div>

<div class="campo">
<label>PP Contenidos *</label>
<input id="PP_Contenidos" name="entry.2021424275" readonly required>
</div>

<div class="campo">
<label>ANI *</label>
<input name="entry.528607190" required>
</div>

<div class="campo">
<label>Suscripción *</label>
<input name="entry.938303002" required>
</div>

<div class="campo">
<label>Resultado *</label>
<select id="Resultado" name="entry.308640399" required>
<option value="">Selecciona</option>
<option value="CONSULTA">CONSULTA</option>
<option value="CONTENIDO">CONTENIDO</option>
<option value="BAJA TOTAL">BAJA TOTAL</option>
<option value="BAJA PARCIAL">BAJA PARCIAL</option>
</select>
</div>

<div class="campo">
<label>Contención *</label>
<select id="Contencion" name="entry.1265624613" required></select>
</div>

<div class="campo">
<label>Trans. Isla *</label>
<select id="TenenciaValidacion" name="entry.526710020" required>
<option value="">Selecciona</option>
<option value="Si">Si</option>
<option value="No">No</option>
</select>
</div>

<div class="campo">
<label>Folio *</label>
<input name="entry.1718642695" required>
</div>

<div class="campo">
<label>Visualizador *</label>
<select id="Visualizador" name="entry.448110065" required></select>
</div>

<div class="campo">
<label>Oferta Aplicada *</label>
<select id="Oferta_aplicada" name="entry.461946160" required></select>
</div>

<div class="campo full">
<label>Observación de No Adhiere *</label>
<select id="Observacion" name="entry.1321924343" required></select>
</div>

<div class="campo">
<label>Migra *</label>
<select id="Realizaste_Cambio_de_Plan" name="entry.1187965590" required></select>
</div>

<div class="campo">
<label>Ofreciste Cross*</label>
<select id="Ofreciste" name="entry.435477933" required>
<option value="">Selecciona</option>
<option value="SI">Si</option>
<option value="NO">No</option>
<option value="NO APLICA">No Aplica</option>
</select>
</div>

<div class="campo">
<label>Motivo No Oferta *</label>
<select id="Motivo_no_oferta" name="entry.217503159" required></select>
</div>

<div class="campo">
<label>Producto Ofrecido *</label>
<select id="Producto" name="entry.795483787" required></select>
</div>

<div class="campo">
<label>Motivo Baja *</label>
<select id="Motivo_baja" name="entry.960725776" required>
<option value="">Selecciona</option>
<option value="Competencia con mejor precio">Competencia con mejor precio</option>
<option value="Falla masiva">Falla masiva</option>
<option value="Fallecimiento">Fallecimiento</option>
<option value="Mala experiencia Técnica">Mala experiencia Técnica</option>
<option value="No entrega información">No entrega información</option>
<option value="No hay factibilidad">No hay factibilidad</option>
<option value="No reconoce venta">No reconoce venta</option>
<option value="Oferta no aplicada">Oferta no aplicada</option>
<option value="Reclamo ajuste IPC">Reclamo ajuste IPC</option>
<option value="Reclamos Facturación">Reclamos Facturación</option>
<option value="Renovación descuento">Renovación descuento</option>
<option value="Situacion económica">Situacion económica</option>
<option value="Sustituye por producto Movistar">Sustituye por producto Movistar</option>
<option value="Traslado">Traslado</option>
<option value="NO APLICA">NO APLICA</option>
</select>
</div>

<div class="campo">
<label>Oferta Máxima *</label>
<select id="Oferta_maxima" name="entry.1087208625" required>
<option value="">Selecciona</option>
    <option value="OFERTA DEL 20">OFERTA DEL 20</option>
    <option value="OFERTA DEL 21">OFERTA DEL 21 </option>
    <option value="OFERTA DEL 22">OFERTA DEL 22 </option>
    <option value="OFERTA DEL 23">OFERTA DEL 23 </option>
    <option value="OFERTA DEL 24">OFERTA DEL 24 </option>
    <option value="OFERTA DEL 25">OFERTA DEL 25 </option>
    <option value="OFERTA DEL 26">OFERTA DEL 26 </option>
    <option value="OFERTA DEL 27">OFERTA DEL 27 </option>
    <option value="OFERTA DEL 28">OFERTA DEL 28 </option>
    <option value="OFERTA DEL 29">OFERTA DEL 29 </option>
    <option value="OFERTA DEL 30">OFERTA DEL 30 </option>
    <option value="OFERTA DEL 31">OFERTA DEL 31 </option>
    <option value="OFERTA DEL 32">OFERTA DEL 32 </option>
    <option value="OFERTA DEL 33">OFERTA DEL 33 </option>
    <option value="OFERTA DEL 34">OFERTA DEL 34 </option>
    <option value="OFERTA DEL 35">OFERTA DEL 35 </option>
    <option value="OFERTA DEL 36">OFERTA DEL 36 </option>
    <option value="OFERTA DEL 37">OFERTA DEL 37 </option>
    <option value="OFERTA DEL 38">OFERTA DEL 38 </option>
    <option value="OFERTA DEL 39">OFERTA DEL 39 </option>
    <option value="OFERTA DEL 40">OFERTA DEL 40 </option>
    <option value="OFERTA DEL 41">OFERTA DEL 41 </option>
    <option value="OFERTA DEL 42">OFERTA DEL 42 </option>
    <option value="OFERTA DEL 43">OFERTA DEL 43 </option>
    <option value="OFERTA DEL 44">OFERTA DEL 44 </option>
    <option value="OFERTA DEL 45">OFERTA DEL 45 </option>
    <option value="OFERTA DEL 46">OFERTA DEL 46 </option>
    <option value="OFERTA DEL 47">OFERTA DEL 47 </option>
    <option value="OFERTA DEL 48">OFERTA DEL 48 </option>
    <option value="OFERTA DEL 49">OFERTA DEL 49 </option>
    <option value="OFERTA DEL 50">OFERTA DEL 50 </option>
    <option value="ARGUMENTARIO">ARGUMENTARIO </option>
    <option value="NO APLICA">NO APLICA </option>
</select>
</div>

</div>

<button type="submit">Enviar</button>
  
<div id="panelResumen" style="margin-top:20px; padding:15px; border:1px solid #ccc; border-radius:8px;">
  <h3>Resumen del Representante</h3>
  <div id="resumenContenido">Sin datos aún...</div>
</div>

  
</form>

<script>
// ========= TU LÓGICA ORIGINAL + VALIDACIÓN =========
function setOptions(select, options) {
  select.innerHTML = "";
  const placeholder = document.createElement("option");
  placeholder.value = "";
  placeholder.textContent = "Selecciona";
  select.appendChild(placeholder);
  options.forEach(opt => {
    const option = document.createElement("option");
    option.value = opt;
    option.textContent = opt;
    select.appendChild(option);
  });
}

const Resultado = document.getElementById("Resultado");
const Tenencia = document.getElementById("Tenencia");
const PP_Contenidos = document.getElementById("PP_Contenidos");
const Visualizador = document.getElementById("Visualizador");
const Oferta_aplicada = document.getElementById("Oferta_aplicada");
const Observacion = document.getElementById("Observacion");
const Realizaste_Cambio_de_Plan = document.getElementById("Realizaste_Cambio_de_Plan");
const Ofreciste = document.getElementById("Ofreciste");
const Motivo_no_oferta = document.getElementById("Motivo_no_oferta");
const Producto = document.getElementById("Producto");
const Contencion = document.getElementById("Contencion");

//Cuando cambias el representante, carga el resumen automáticamente
document.querySelector('select[name="entry.223399256"]')
  .addEventListener("change", function () {
    if (this.value) {
      cargarResumenRepresentante(this.value);
    }
  });


// PP Contenidos
function actualizarPPContenidos() {
  const t = Tenencia.value;
  const r = Resultado.value;
  if (!t || !r) { PP_Contenidos.value = "0"; return; }
  if (r === "CONTENIDO") PP_Contenidos.value = (t === "Trio") ? "2" : "1";
  else if (r === "BAJA PARCIAL") PP_Contenidos.value = (t === "Trio" || t === "Duo") ? "1" : "0";
  else PP_Contenidos.value = "0";
}
Tenencia.addEventListener("change", actualizarPPContenidos);
Resultado.addEventListener("change", actualizarPPContenidos);

// Resultado dinámico
Resultado.addEventListener("change", function() {
  const val = this.value.toUpperCase();
  if (["CONSULTA","BAJA TOTAL"].includes(val)) setOptions(Visualizador, ["NO APLICA"]);
  else if (["CONTENIDO","BAJA PARCIAL"].includes(val)) setOptions(Visualizador, ["SI","NO","Argumentario"]);
  else setOptions(Visualizador, []);

  if (val === "CONSULTA") setOptions(Contencion, ["NO APLICA (Solo consultas)"]);
  else if (["CONTENIDO","BAJA PARCIAL"].includes(val)) setOptions(Contencion, ["SI"]);
  else if (val === "BAJA TOTAL") setOptions(Contencion, ["NO"]);
  else setOptions(Contencion, []);

  if (["BAJA TOTAL","CONSULTA"].includes(val)) setOptions(Realizaste_Cambio_de_Plan, ["NO APLICA"]);
  else if (val === "CONTENIDO") setOptions(Realizaste_Cambio_de_Plan, ["MIGRA DOWN","MIGRA UP","ALOCACION","NO APLICA"]);
  else if (val === "BAJA PARCIAL") setOptions(Realizaste_Cambio_de_Plan, ["BAJA PARCIAL"]);
  else setOptions(Realizaste_Cambio_de_Plan, []);
});

// Visualizador
Visualizador.addEventListener("change", function() {
  const val = this.value.toUpperCase();
  if (val === "SI") setOptions(Oferta_aplicada, ["OFERTA 1","OFERTA 2","OFERTA 3"]);
  else if (val === "NO") setOptions(Oferta_aplicada, ["OFERTA NO ADHERIDA"]);
  else if (val === "ARGUMENTARIO") setOptions(Oferta_aplicada, ["ARGUMENTARIO"]);
  else setOptions(Oferta_aplicada, ["NO APLICA"]);
});

// Observación
Oferta_aplicada.addEventListener("change", function() {
  const val = this.value.toUpperCase();
  if (["OFERTA 1","OFERTA 2","OFERTA 3"].includes(val))
    setOptions(Observacion, ["CLIENTE CONFORME CON OFERTA DE VISUALIZADOR"]);
  else if (val === "ARGUMENTARIO")
    setOptions(Observacion, ["ARGUMENTARIO"]);
  else if (val === "OFERTA NO ADHERIDA")
    setOptions(Observacion, [
      "RETE - OFERTA NO SE ADAPTA A NECESIDAD DEL CLIENTE",
      "N2 - OFERTA NO SE ADAPTA A NECESIDAD DEL CLIENTE",
      "SOLICITA LA OFERTA MAS AGRESIVA",
      "OFERTADOR NO ARROJA OPCIONES"
    ]);
  else setOptions(Observacion, ["NO APLICA"]);
});

// Ofreciste
Ofreciste.addEventListener("change", function() {
  const val = this.value.toUpperCase();
  if (val === "SI") {
    setOptions(Motivo_no_oferta, ["NO APLICA"]);
    setOptions(Producto, ["FIBRA","ALTA MÓVIL","PORTABILIDAD MÓVIL","FIBRA + MÓVIL","RECAMBIO","FIBRA + RECAMBIO","MOVIL + RECAMBIO"]);
  } else if (val === "NO") {
    setOptions(Motivo_no_oferta, ["CLIENTE","VMO","EXPERIENCIA ANTERIOR"]);
    setOptions(Producto, ["NO APLICA"]);
  } else {
    setOptions(Motivo_no_oferta, ["NO APLICA"]);
    setOptions(Producto, ["NO APLICA"]);
  }
});
// nuevo pegado
async function cargarResumenRepresentante(nombreRep) {
  const urlCSV = "https://docs.google.com/spreadsheets/d/e/2PACX-1vRUiLLFSDvgj2HRQjmt9OWRmUbOjR1gsWJI8777eIJwEavDZyLmn57lNG2bdqNG7EE21rWhji3iEpNw/pub?output=csv";

  const response = await fetch(urlCSV);
  const csvText = await response.text();

  const resultado = Papa.parse(csvText, {
    header: true,
    skipEmptyLines: true
  });

  const datos = resultado.data;

  const filasRep = datos.filter(f =>
    (f["REPRESENTANTE"] || "").trim().toUpperCase() === nombreRep.trim().toUpperCase()
  );

  if (filasRep.length === 0) {
    document.getElementById("resumenContenido").innerHTML =
      "No hay registros para este representante.";
    return;
  }
  // ===== FUNCION PARA SUMAR COLUMNAS =====
function sumar(col) {
  return filasRep.reduce((acc, f) => {
    let valor = f[col];

    if (!valor) return acc;

    // Limpiar el valor que viene del CSV
    valor = valor.toString().trim();     // quita espacios
    valor = valor.replace(",", ".");     // cambia coma por punto

    const numero = Number(valor);

    return acc + (isNaN(numero) ? 0 : numero);
  }, 0);
}


// ===== CALCULOS =====
const contenidosFO = sumar("Q CONTENIDOS FO");
const noContenidosFO = sumar("Q NO CONTENIDOS FO");
const adheridas = sumar("Q LÍNEAS CON OFERTA DE VISUALIZADOR");
const ofertasAplicadas = sumar("Q DE OFERTAS APLICADAS");
const totalcontenidos = sumar("PP CONTENIDOS");
const targumentario = sumar("Q DE ARGUMENTARIOS");
const ofertadhe = sumar("Q LÍNEAS CON OFERTA DE VISUALIZADOR");
const cambiodeplan = sumar("MIGRA");
const bajaparcial= sumar("BAJA PARC.");
  


// Evitar división entre 0
const efectividad = (contenidosFO + noContenidosFO) > 0
  ? ((contenidosFO / (contenidosFO + noContenidosFO)) * 100).toFixed(2)
  : 0;

const adherencia = ofertasAplicadas > 0
  ? ((adheridas / ofertasAplicadas) * 100).toFixed(2)
  : 0;

const argumentario = (contenidosFO + noContenidosFO) > 0
  ? ((targumentario / (contenidosFO + noContenidosFO)) * 100).toFixed(2)
  : 0;

const oferta = (contenidosFO + noContenidosFO) > 0
  ? ((ofertadhe / (contenidosFO + noContenidosFO)) * 100).toFixed(2)
  : 0;
  
const capl = (totalcontenidos - targumentario) > 0
  ? ((cambiodeplan / (totalcontenidos - targumentario)) * 100).toFixed(2)
  : 0;  
  
const bparcial = (totalcontenidos - targumentario) > 0
  ? ((bajaparcial / (totalcontenidos - targumentario)) * 100).toFixed(2)
  : 0; 
  

// ===== PINTAR RESUMEN =====
let resumenHTML = `
  <div style="display:flex; gap:30px; margin-bottom:20px; font-size:18px;">
    <div style="background:#e8f5e9; padding:15px; border-radius:8px;">
      <b>EFECTIVIDAD</b><br>
      ${efectividad} %
    </div>
    <div style="background:#e3f2fd; padding:15px; border-radius:8px;">
      <b>ADHERENCIA</b><br>
      ${adherencia} %
    </div>
    <div style="background:#FFE0FF; padding:15px; border-radius:8px;">
      <b>CONTENIDOS</b><br>
      ${totalcontenidos} 
     </div>
    <div style="background:#F5F7FA; padding:15px; border-radius:8px;">
      <b>Argumentario</b><br>
      ${argumentario} %
     </div>
    <div style="background:#e8f5e9; padding:15px; border-radius:8px;">
      <b>Oferta</b><br>
      ${oferta} %
     </div>
     
    <div style="background:#E6CFE6; padding:15px; border-radius:8px;">
      <b>Cambio Plan</b><br>
      ${capl} %
     </div>

    <div style="background:#D8BFD8; padding:15px; border-radius:8px;">
      <b>Baja Parc.</b><br>
      ${bparcial} %
     </div>
     
     
  </div>
`;


  // ===== MOSTRAR REGISTROS EN TABLA =====
let tabla = `
  <div style="overflow-x:auto; width:100%;">
  <table style="border-collapse:collapse; font-size:12px; min-width:1400px;">
    <tr style="background:#f0f0f0;">
      ${Object.keys(filasRep[0]).map(col => `<th>${col}</th>`).join("")}
    </tr>
`;

filasRep.forEach(fila => {
  tabla += "<tr>";
  Object.values(fila).forEach(valor => {
    tabla += `<td>${valor || ""}</td>`;
  });
  tabla += "</tr>";
});

tabla += "</table></div>";


document.getElementById("resumenContenido").innerHTML = resumenHTML + tabla;


}


  
// Validación + envío
document.getElementById("googleForm").addEventListener("submit", async function(e) {

  e.preventDefault();

  let valido = true;
  this.querySelectorAll("select, input").forEach(campo => {
    campo.classList.remove("error");
    if (!campo.value) {
      campo.classList.add("error");
      valido = false;
    }
  });

  if (!valido) {
    alert("Debes completar TODOS los campos obligatorios");
    return;
  }

  const formData1 = new FormData(this);
  const formData2 = new FormData();

  // ===== Mapeo al segundo Form =====
  function copiar(origen, destino, a, b) {
  const valor = origen.get(a);
  destino.append(b, valor ? valor : "");
}

copiar(formData1, formData2, "entry.223399256", "entry.492315650");
copiar(formData1, formData2, "entry.263067344", "entry.1231747244");
copiar(formData1, formData2, "entry.2021424275", "entry.459211310");
copiar(formData1, formData2, "entry.528607190", "entry.1964130523");
copiar(formData1, formData2, "entry.938303002", "entry.482337000");
copiar(formData1, formData2, "entry.308640399", "entry.642025137");
copiar(formData1, formData2, "entry.1265624613", "entry.1990652723");
copiar(formData1, formData2, "entry.526710020", "entry.1481086183");
copiar(formData1, formData2, "entry.1718642695", "entry.257593832");
copiar(formData1, formData2, "entry.448110065", "entry.1892522086");
copiar(formData1, formData2, "entry.461946160", "entry.728954034");
copiar(formData1, formData2, "entry.1321924343", "entry.1965024523");
copiar(formData1, formData2, "entry.1187965590", "entry.1126405093");
copiar(formData1, formData2, "entry.435477933", "entry.1388418047");
copiar(formData1, formData2, "entry.217503159", "entry.1986891665");
copiar(formData1, formData2, "entry.795483787", "entry.301914441");
copiar(formData1, formData2, "entry.960725776", "entry.1577832641");
copiar(formData1, formData2, "entry.1087208625", "entry.669962419");


  // ===== Envío a los 2 forms =====
  await Promise.all([
    fetch("https://docs.google.com/forms/d/1Mlds1RQPtTiL2oqL0dtmKdilH2Y2X57KW1V3ADudOa8/formResponse", {
      method: "POST",
      mode: "no-cors",
      body: formData1
    }),
    fetch("https://docs.google.com/forms/u/0/d/e/1FAIpQLSdGn8cGGxPQ4n6U6VwusujgUADpLVk2tIpEe3se9cnZmP_TeQ/formResponse", {
      method: "POST",
      mode: "no-cors",
      body: formData2
    })
  ]);

  const rep = formData1.get("entry.223399256");

  this.reset();

  document.querySelector('select[name="entry.223399256"]').value = rep;

  cargarResumenRepresentante(rep);

});


  
// ===== Inicializar selects vacíos al cargar =====
window.addEventListener("load", () => {
  setOptions(Contencion, []);
  setOptions(Visualizador, []);
  setOptions(Oferta_aplicada, []);
  setOptions(Observacion, []);
  setOptions(Realizaste_Cambio_de_Plan, []);
  setOptions(Motivo_no_oferta, []);
  setOptions(Producto, []);

 Resultado.dispatchEvent(new Event("change"));
  Visualizador.dispatchEvent(new Event("change"));
  Ofreciste.dispatchEvent(new Event("change"));
  
});


</script>

</body>
</html>





























