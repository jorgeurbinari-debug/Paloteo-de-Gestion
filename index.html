<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Formulario Google</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <style>
    body {
      font-family: Arial, sans-serif;
      background: #f4f6f8;
      padding: 15px;
    }

    h2 {
      text-align: center;
    }

    form {
      max-width: 700px;
      margin: auto;
      background: #fff;
      padding: 20px;
      border-radius: 8px;
    }

    select, input, button {
      width: 100%;
      padding: 10px;
      margin-bottom: 12px;
      font-size: 14px;
    }

    hr {
      margin: 20px 0;
    }

    button {
      background: #1d4ed8;
      color: white;
      border: none;
      border-radius: 5px;
      cursor: pointer;
    }

    button:hover {
      background: #1e40af;
    }

    .error {
      border: 2px solid #e63946;
      background: #fff0f0;
    }

    .error-msg {
      color: #e63946;
      font-size: 12px;
      margin-top: -8px;
      margin-bottom: 8px;
    }
  </style>
</head>

<body>

<h2>Registro</h2>

<form id="googleForm">

  <!-- REPRESENTANTE -->
  <select name="entry.223399256" required>
    <option value="">Selecciona Representante</option>
    <option value="AGUILAR VARGAS URSULA NOEMI">AGUILAR VARGAS URSULA NOEMI</option>
    <option value="ALTAMIRANO MEGO MARIO SERGIO">ALTAMIRANO MEGO MARIO SERGIO</option>
    <option value="CRISANTO LARTIGA MARIA VANESSA">CRISANTO LARTIGA MARIA VANESSA</option>
    <option value="DELGADO FARRO MITZY YOSHELY">DELGADO FARRO MITZY YOSHELY</option>
    <option value="GONZALES SAENZ EDGARDO DAVID">GONZALES SAENZ EDGARDO DAVID</option>
    <option value="RIVERA MERA JESSICA KARINA">RIVERA MERA JESSICA KARINA</option>
    <option value="VELASQUEZ SENMACHE MIGUEL ANGEL">VELASQUEZ SENMACHE MIGUEL ANGEL</option>
    <option value="ÑIQUEN ARROYO KATTIA LISET">ÑIQUEN ARROYO KATTIA LISET</option>
  </select>

  <!-- TENENCIA -->
  <select id="tenencia" name="entry.263067344" required>
    <option value="">Selecciona Tenencia</option>
    <option value="Trio">Trio</option>
    <option value="Duo">Duo</option>
    <option value="Mono">Mono</option>
  </select>

  <!-- PP CONTENIDOS -->
  <input id="ppContenidos" name="entry.2021424275" placeholder="PP Contenidos" readonly required>

  <input name="entry.528607190" placeholder="ANI" required>
  <input name="entry.938303002" placeholder="Suscripción" required>

  <!-- RESULTADO -->
  <select id="resultado" name="entry.308640399" required>
    <option value="">Selecciona Resultado</option>
    <option value="CONSULTA">CONSULTA</option>
    <option value="CONTENIDO">CONTENIDO</option>
    <option value="BAJA TOTAL">BAJA TOTAL</option>
    <option value="BAJA PARCIAL">BAJA PARCIAL</option>
  </select>

  <hr>

  <!-- CONTENCION -->
  <input id="contencion" name="entry.1265624613" placeholder="Contención" readonly required>

  <input name="entry.1718642695" placeholder="Folio" required>

  <!-- VISUALIZADOR -->
  <input id="visualizador" name="entry.448110065" placeholder="Visualizador" readonly required>

  <!-- OFERTA APLICADA -->
  <input id="ofertaAplicada" name="entry.461946160" placeholder="Oferta aplicada" readonly required>

  <input id="observacion" name="entry.1321924343" placeholder="Observación">

  <hr>

  <!-- OFRECISTE -->
  <select id="ofreciste" name="entry.435477933" required>
    <option value="">¿Ofreciste?</option>
    <option value="SI">SI</option>
    <option value="NO">NO</option>
    <option value="NO APLICA">NO APLICA</option>
  </select>

  <!-- MOTIVO NO OFERTA -->
  <input id="motivoNoOferta" name="entry.217503159" placeholder="Motivo no oferta">

  <input name="entry.795483787" placeholder="Producto" required>

  <!-- OFERTA MAXIMA -->
  <select name="entry.1087208625" required>
    <option value="">Oferta máxima</option>
    <option value="OFERTA DEL 20">OFERTA DEL 20</option>
    <option value="OFERTA DEL 30">OFERTA DEL 30</option>
    <option value="OFERTA DEL 40">OFERTA DEL 40</option>
    <option value="NO APLICA">NO APLICA</option>
  </select>

  <button type="submit">Enviar</button>
</form>

<script>
/* ================== LOGICA AUTOMATICA ================== */

const tenencia = document.getElementById("tenencia");
const resultado = document.getElementById("resultado");
const pp = document.getElementById("ppContenidos");
const contencion = document.getElementById("contencion");
const visualizador = document.getElementById("visualizador");
const oferta = document.getElementById("ofertaAplicada");
const ofreciste = document.getElementById("ofreciste");
const motivo = document.getElementById("motivoNoOferta");
const observacion = document.getElementById("observacion");

function actualizarPP() {
  const t = tenencia.value;
  const r = resultado.value;

  if (r === "CONTENIDO") {
    pp.value = (t === "Trio") ? "2" : (t ? "1" : "0");
  } else if (r === "BAJA PARCIAL" && (t === "Trio" || t === "Duo")) {
    pp.value = "1";
  } else {
    pp.value = "0";
  }
}

function actualizarContencion() {
  if (resultado.value === "CONSULTA") contencion.value = "NO APLICA";
  else if (resultado.value === "BAJA TOTAL") contencion.value = "NO";
  else if (resultado.value) contencion.value = "SI";
  else contencion.value = "";
}

function actualizarVisualizador() {
  if (resultado.value === "CONSULTA" || resultado.value === "BAJA TOTAL") {
    visualizador.value = "NO APLICA";
    oferta.value = "NO APLICA";
  } else {
    visualizador.value = "SI";
    oferta.value = "OFERTA APLICADA";
  }
}

tenencia.addEventListener("change", actualizarPP);
resultado.addEventListener("change", () => {
  actualizarPP();
  actualizarContencion();
  actualizarVisualizador();
});

ofreciste.addEventListener("change", () => {
  motivo.value = (ofreciste.value === "NO") ? "" : "NO APLICA";
});

/* ================== VALIDACION ================== */

function limpiarErrores() {
  document.querySelectorAll(".error").forEach(e => e.classList.remove("error"));
  document.querySelectorAll(".error-msg").forEach(e => e.remove());
}

function error(el, msg) {
  el.classList.add("error");
  const d = document.createElement("div");
  d.className = "error-msg";
  d.innerText = msg;
  el.after(d);
}

document.getElementById("googleForm").addEventListener("submit", function(e) {
  e.preventDefault();
  limpiarErrores();
  let ok = true;

  if (resultado.value === "CONTENIDO" && pp.value === "0") {
    error(pp, "PP Contenidos inválido");
    ok = false;
  }

  if (ofreciste.value === "NO" && !motivo.value) {
    error(motivo, "Debes indicar motivo");
    ok = false;
  }

  if (!ok) {
    alert("⚠️ Corrige los errores antes de enviar");
    return;
  }

  fetch(
    "https://docs.google.com/forms/d/1Mlds1RQPtTiL2oqL0dtmKdilH2Y2X57KW1V3ADudOa8/formResponse",
    { method: "POST", mode: "no-cors", body: new FormData(this) }
  );

  alert("✅ Datos enviados correctamente");
  this.reset();
});
</script>

</body>
</html>
